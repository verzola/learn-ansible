---
- name: Install and update packages
  hosts: all
  tasks:
    - name: Add neovim ppa
      become: true
      apt_repository:
        validate_certs: no
        repo: 'ppa:neovim-ppa/stable'
        state: present

    - name: Add ansible ppa
      become: true
      apt_repository:
        validate_certs: no
        repo: 'ppa:ansible/ansible'
        state: present


    - name: Add hashicorp gpg key
      become: true
      apt_key:
        url: https://apt.releases.hashicorp.com/gpg
        state: present

    - name: Add hashicorp repository
      become: true
      apt_repository:
        repo: deb [arch=amd64] https://apt.releases.hashicorp.com {{ ansible_lsb.codename }} main
        state: present
        update_cache: true

    - name: Add nodejs gpg key
      become: true
      apt_key:
        url: https://deb.nodesource.com/gpgkey/nodesource.gpg.key
        state: present

    - name: Add nodejs repository
      become: true
      apt_repository:
        repo: deb https://deb.nodesource.com/node_16.x {{ ansible_lsb.codename }} main
        state: present
        update_cache: true

    - name: Install packages
      become: true
      apt:
        update_cache: yes
        name:
          - ansible
          - apt-transport-https
          - bat
          - build-essential
          - ca-certificates
          - curl
          - g++
          - gcc
          - git
          - htop
          - make
          - neofetch
          - neovim
          - nodejs
          - openjdk-11-jdk
          - openssh-server
          - php-cli
          - python3
          - python3-pip
          - software-properties-common
          - terraform
          - tmux
          - unzip
          - vagrant
          - vim
          - virtualbox
          - zip
          - zsh
        state: latest

    - name: Update packages
      become: true
      apt:
        upgrade: dist

    - name: Remove useless packages from the cache
      become: true
      apt:
        autoclean: yes

    - name: Remove dependencies that are no longer required
      become: true
      apt:
        autoremove: yes

    - name: Install "yarn" node.js package globally.
      become: true
      npm:
        name: yarn
        global: yes

    - name: Configure Git username
      git_config:
        name: user.name
        scope: global
        value: 'Gustavo Verzola'

    - name: Configure Git e-mail
      git_config:
        name: user.email
        scope: global
        value: verzola@gmail.com

    - name: Create my projects folder
      file:
        path: ~/projects/verzola
        state: directory

    - name: Clone zsh configuration
      git:
        repo: https://github.com/verzola/.zshrc.git
        dest: ~/projects/verzola/zshrc
        clone: yes
        update: yes

    - name: Create zsh symbolic link
      file:
        src: ~/projects/verzola/zshrc/.zshrc
        dest: ~/.zshrc
        state: link

    - name: Clone tmux configuration
      git:
        repo: https://github.com/verzola/.tmux.conf.git
        dest: ~/projects/verzola/tmux.conf
        clone: yes
        update: yes

    - name: Install tmux plugin manager
      git:
        repo: https://github.com/tmux-plugins/tpm
        dest: ~/.tmux/plugins/tpm
        clone: yes
        update: yes

    - name: Create tmux symbolic link
      file:
        src: ~/projects/verzola/tmux.conf/.tmux.conf
        dest: ~/.tmux.conf
        state: link

    - name: Install tmux plugins
      shell: ~/.tmux/plugins/tpm/scripts/install_plugins.sh

    - name: Install vim-plug
      get_url:
        dest: "{{ vim_dir }}/autoload/plug.vim"
        url: https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

    - name: Clone vim configuration
      git:
        repo: https://github.com/verzola/.vimrc.git
        dest: ~/projects/verzola/vimrc
        clone: yes
        update: yes

    - name: Create vim symbolic link
      file:
        src: ~/projects/verzola/vimrc/.vimrc
        dest: ~/.vimrc
        state: link
        force: true

    - name: Create neovim config folder
      file:
        path: ~/.config/nvim
        state: directory

    - name: Create neovim symbolic link
      file:
        src: ~/projects/verzola/vimrc/.vimrc
        dest: ~/.config/nvim/init.vim
        state: link

    - name: Clone aliases configuration
      git:
        repo: https://github.com/verzola/aliases.git
        dest: ~/projects/verzola/aliases
        clone: yes
        update: yes

    - name: change user shell to zsh
      become: yes
      user:
        name: vagrant
        shell: /bin/zsh
